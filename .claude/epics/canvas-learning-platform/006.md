---
name: assignment-system
epic: canvas-learning-platform
status: backlog
priority: high
created: 2025-09-05T08:14:35Z
effort: 7
complexity: medium
tags: [assignments, grading, file-upload, submissions]
depends_on: [001, 002, 003]
parallel: [004, 005]
github: [Will be updated when synced to GitHub]
---

# Task: Assignment System

## Overview

Implement comprehensive assignment management system with creation workflows, student submissions, file handling, automated grading features, and gradebook integration. Features include assignment templates, due date management, plagiarism detection, rubric-based grading, and detailed progress tracking.

## Context

The assignment system is a core academic feature of the Canvas Learning Platform that enables teachers to create, distribute, and grade assignments while providing students with streamlined submission workflows. This integrates with the course management system to provide role-based access and comprehensive academic progress tracking.

## Acceptance Criteria

### Functional Requirements
- [ ] Teachers can create assignments with detailed instructions and requirements
- [ ] Multiple assignment types: essays, multiple choice, file uploads, online submissions
- [ ] Due date management with automatic late submission tracking
- [ ] Student submission interface with draft saving capabilities
- [ ] File upload support for various formats (PDF, DOC, images, videos)
- [ ] Automated grading for multiple choice and structured questions
- [ ] Rubric-based grading system with custom criteria
- [ ] Grade book integration with export capabilities
- [ ] Assignment analytics and progress tracking
- [ ] Bulk operations for assignment management

### Technical Requirements
- [ ] Secure file storage with version control
- [ ] Real-time submission status updates
- [ ] Automated backup of student work
- [ ] Plagiarism detection integration (TurnitIn-style)
- [ ] Grade calculation engine with weighted categories
- [ ] Assignment scheduling and publishing system
- [ ] Cross-platform file handling (Web/Mobile)
- [ ] Database optimization for large file attachments

### User Experience Requirements
- [ ] Intuitive assignment creation wizard
- [ ] Drag-and-drop file submission interface
- [ ] Mobile-optimized assignment viewing and submission
- [ ] Real-time save indicators and progress tracking
- [ ] Comprehensive feedback system with inline comments
- [ ] Student dashboard with upcoming assignments
- [ ] Teacher gradebook with filtering and sorting
- [ ] Accessibility: screen reader and keyboard navigation support

## Technical Approach

### Database Schema Design

#### Core Assignment Tables
```sql
-- Assignment definitions
CREATE TABLE assignments (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    course_id UUID REFERENCES courses(id) ON DELETE CASCADE,
    title VARCHAR(255) NOT NULL,
    description TEXT,
    instructions TEXT,
    assignment_type assignment_type NOT NULL, -- 'essay', 'quiz', 'file_upload', 'online_text'
    points_possible DECIMAL(8,2) DEFAULT 0,
    due_date TIMESTAMPTZ,
    available_from TIMESTAMPTZ DEFAULT now(),
    available_until TIMESTAMPTZ,
    submission_types TEXT[] DEFAULT ARRAY['online_text_entry'],
    allow_late_submissions BOOLEAN DEFAULT true,
    late_penalty_per_day DECIMAL(5,2) DEFAULT 0,
    created_by UUID REFERENCES profiles(id),
    created_at TIMESTAMPTZ DEFAULT now(),
    updated_at TIMESTAMPTZ DEFAULT now(),
    is_published BOOLEAN DEFAULT false,
    grading_rubric_id UUID REFERENCES grading_rubrics(id)
);

-- Student submissions
CREATE TABLE assignment_submissions (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    assignment_id UUID REFERENCES assignments(id) ON DELETE CASCADE,
    student_id UUID REFERENCES profiles(id) ON DELETE CASCADE,
    submission_text TEXT,
    submitted_at TIMESTAMPTZ,
    late_submission BOOLEAN DEFAULT false,
    attempt_number INTEGER DEFAULT 1,
    status submission_status DEFAULT 'draft', -- 'draft', 'submitted', 'graded', 'returned'
    grade DECIMAL(8,2),
    graded_at TIMESTAMPTZ,
    graded_by UUID REFERENCES profiles(id),
    feedback TEXT,
    created_at TIMESTAMPTZ DEFAULT now(),
    updated_at TIMESTAMPTZ DEFAULT now(),
    UNIQUE(assignment_id, student_id, attempt_number)
);

-- File attachments for submissions
CREATE TABLE submission_files (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    submission_id UUID REFERENCES assignment_submissions(id) ON DELETE CASCADE,
    file_name VARCHAR(255) NOT NULL,
    original_name VARCHAR(255) NOT NULL,
    file_size BIGINT NOT NULL,
    file_type VARCHAR(100),
    storage_path TEXT NOT NULL,
    upload_progress INTEGER DEFAULT 100,
    virus_scan_status VARCHAR(20) DEFAULT 'pending',
    created_at TIMESTAMPTZ DEFAULT now()
);

-- Grading rubrics
CREATE TABLE grading_rubrics (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    course_id UUID REFERENCES courses(id),
    name VARCHAR(255) NOT NULL,
    description TEXT,
    total_points DECIMAL(8,2) NOT NULL,
    created_by UUID REFERENCES profiles(id),
    created_at TIMESTAMPTZ DEFAULT now()
);

-- Rubric criteria
CREATE TABLE rubric_criteria (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    rubric_id UUID REFERENCES grading_rubrics(id) ON DELETE CASCADE,
    name VARCHAR(255) NOT NULL,
    description TEXT,
    points DECIMAL(8,2) NOT NULL,
    criteria_order INTEGER NOT NULL
);

-- Grade entries for rubric-based grading
CREATE TABLE submission_grades (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    submission_id UUID REFERENCES assignment_submissions(id) ON DELETE CASCADE,
    criteria_id UUID REFERENCES rubric_criteria(id),
    points_awarded DECIMAL(8,2) NOT NULL,
    comment TEXT,
    graded_by UUID REFERENCES profiles(id),
    created_at TIMESTAMPTZ DEFAULT now()
);

-- Assignment analytics
CREATE TABLE assignment_analytics (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    assignment_id UUID REFERENCES assignments(id) ON DELETE CASCADE,
    total_submissions INTEGER DEFAULT 0,
    on_time_submissions INTEGER DEFAULT 0,
    late_submissions INTEGER DEFAULT 0,
    average_grade DECIMAL(8,2),
    median_grade DECIMAL(8,2),
    grade_distribution JSONB,
    updated_at TIMESTAMPTZ DEFAULT now()
);
```

### Implementation Components

#### 1. Assignment Service
```dart
class AssignmentService {
  final SupabaseClient _supabase;
  
  Future<List<Assignment>> getCourseAssignments(String courseId) async {
    final response = await _supabase
        .from('assignments')
        .select('*, grading_rubrics(*)')
        .eq('course_id', courseId)
        .eq('is_published', true)
        .order('due_date');
    
    return response.map((json) => Assignment.fromJson(json)).toList();
  }
  
  Future<Assignment> createAssignment(CreateAssignmentRequest request) async {
    final response = await _supabase
        .from('assignments')
        .insert(request.toJson())
        .select()
        .single();
    
    return Assignment.fromJson(response);
  }
  
  Future<AssignmentSubmission> submitAssignment(
    String assignmentId,
    String studentId,
    SubmissionData data,
  ) async {
    // Handle text submission and file uploads
  }
  
  Future<void> gradeSubmission(
    String submissionId,
    double grade,
    String feedback,
    List<RubricGrade>? rubricGrades,
  ) async {
    // Apply grade and rubric scores
  }
}
```

#### 2. Assignment Creation Widget
```dart
class AssignmentCreationForm extends StatefulWidget {
  final String courseId;
  
  @override
  State<AssignmentCreationForm> createState() => _AssignmentCreationFormState();
}

class _AssignmentCreationFormState extends State<AssignmentCreationForm> {
  final _formKey = GlobalKey<FormState>();
  final _titleController = TextEditingController();
  final _instructionsController = TextEditingController();
  
  AssignmentType _selectedType = AssignmentType.essay;
  DateTime? _dueDate;
  double _pointsPossible = 100.0;
  List<String> _submissionTypes = ['online_text_entry'];
  bool _allowLateSubmissions = true;
  
  @override
  Widget build(BuildContext context) {
    return Form(
      key: _formKey,
      child: Column(
        children: [
          TextFormField(
            controller: _titleController,
            decoration: InputDecoration(labelText: 'Assignment Title'),
            validator: (value) => value?.isEmpty == true ? 'Title required' : null,
          ),
          DropdownButtonFormField<AssignmentType>(
            value: _selectedType,
            items: AssignmentType.values.map((type) {
              return DropdownMenuItem(value: type, child: Text(type.displayName));
            }).toList(),
            onChanged: (type) => setState(() => _selectedType = type!),
          ),
          DateTimePickerField(
            labelText: 'Due Date',
            onChanged: (date) => setState(() => _dueDate = date),
          ),
          RubricSelector(onRubricSelected: _onRubricSelected),
          ElevatedButton(
            onPressed: _submitAssignment,
            child: Text('Create Assignment'),
          ),
        ],
      ),
    );
  }
}
```

#### 3. Student Submission Interface
```dart
class AssignmentSubmissionScreen extends StatefulWidget {
  final Assignment assignment;
  
  @override
  Widget build(BuildContext context) {
    return Scaffold(
      appBar: AppBar(title: Text(assignment.title)),
      body: Column(
        children: [
          AssignmentDetailsCard(assignment: assignment),
          Expanded(
            child: TabBarView(
              children: [
                if (assignment.allowsTextSubmission) TextSubmissionTab(),
                if (assignment.allowsFileUpload) FileSubmissionTab(),
                SubmissionHistoryTab(),
              ],
            ),
          ),
          SubmissionActionsBar(),
        ],
      ),
    );
  }
}

class FileSubmissionTab extends StatefulWidget {
  @override
  Widget build(BuildContext context) {
    return Column(
      children: [
        DragDropFileUpload(
          onFilesSelected: _handleFileUpload,
          acceptedTypes: ['pdf', 'doc', 'docx', 'jpg', 'png'],
          maxFiles: 5,
        ),
        Expanded(child: UploadedFilesList()),
      ],
    );
  }
}
```

#### 4. Grading Interface
```dart
class GradingScreen extends StatefulWidget {
  final AssignmentSubmission submission;
  
  @override
  Widget build(BuildContext context) {
    return Scaffold(
      body: Row(
        children: [
          Expanded(
            flex: 2,
            child: SubmissionViewer(submission: submission),
          ),
          Container(
            width: 400,
            child: GradingPanel(
              submission: submission,
              rubric: submission.assignment.rubric,
              onGradeSubmitted: _handleGradeSubmission,
            ),
          ),
        ],
      ),
    );
  }
}

class RubricGradingWidget extends StatelessWidget {
  final GradingRubric rubric;
  final Function(List<RubricGrade>) onGradesChanged;
  
  @override
  Widget build(BuildContext context) {
    return ListView.builder(
      itemCount: rubric.criteria.length,
      itemBuilder: (context, index) {
        final criteria = rubric.criteria[index];
        return RubricCriteriaCard(
          criteria: criteria,
          onPointsChanged: (points) => _updateCriteriaGrade(index, points),
        );
      },
    );
  }
}
```

### File Upload and Storage

#### File Upload Service
```dart
class FileUploadService {
  final SupabaseClient _supabase;
  
  Future<UploadResult> uploadSubmissionFile(
    File file,
    String submissionId,
    {Function(double)? onProgress}
  ) async {
    final fileName = '${uuid.v4()}_${file.path.split('/').last}';
    final storagePath = 'submissions/$submissionId/$fileName';
    
    try {
      // Virus scan check
      await _performVirusScan(file);
      
      // Upload with progress tracking
      final response = await _supabase.storage
          .from('assignment-files')
          .upload(storagePath, file, fileOptions: FileOptions(
            onUploadProgress: onProgress,
          ));
      
      // Store file metadata
      await _supabase.from('submission_files').insert({
        'submission_id': submissionId,
        'file_name': fileName,
        'original_name': file.path.split('/').last,
        'file_size': await file.length(),
        'file_type': _getFileType(file.path),
        'storage_path': storagePath,
      });
      
      return UploadResult.success(storagePath);
    } catch (e) {
      return UploadResult.error(e.toString());
    }
  }
  
  Future<void> _performVirusScan(File file) async {
    // Integrate with virus scanning service
    // Placeholder for security implementation
  }
}
```

#### File Preview Component
```dart
class FilePreviewWidget extends StatelessWidget {
  final SubmissionFile file;
  
  @override
  Widget build(BuildContext context) {
    switch (file.fileType) {
      case 'pdf':
        return PDFPreview(filePath: file.storagePath);
      case 'jpg':
      case 'png':
        return ImagePreview(filePath: file.storagePath);
      case 'doc':
      case 'docx':
        return DocumentPreview(filePath: file.storagePath);
      default:
        return FileInfoCard(file: file);
    }
  }
}
```

## UI/UX Design Requirements

### Assignment Creation Flow

#### Step-by-Step Wizard
1. **Basic Information**: Title, description, type selection
2. **Settings**: Due dates, points, submission types
3. **Grading Setup**: Rubric selection or creation
4. **Review & Publish**: Preview and final confirmation

#### Responsive Design
- **Desktop**: Side-by-side preview and editing
- **Tablet**: Collapsible preview panel
- **Mobile**: Full-screen editing with preview mode

### Student Submission Experience

#### Submission Dashboard
- Assignment cards with due dates and status
- Progress indicators for partially completed assignments
- Quick access to recently viewed assignments
- Calendar integration for due date tracking

#### Mobile-Optimized Submission
- Touch-friendly file selection interface
- Camera integration for document scanning
- Offline draft saving capabilities
- Push notifications for due date reminders

### Teacher Grading Interface

#### Gradebook View
```dart
class GradebookScreen extends StatelessWidget {
  @override
  Widget build(BuildContext context) {
    return DataTable(
      columns: [
        DataColumn(label: Text('Student')),
        DataColumn(label: Text('Assignment 1')),
        DataColumn(label: Text('Assignment 2')),
        DataColumn(label: Text('Total Grade')),
      ],
      rows: students.map((student) {
        return DataRow(
          cells: [
            DataCell(Text(student.name)),
            DataCell(GradeCell(grade: student.grades['assignment1'])),
            DataCell(GradeCell(grade: student.grades['assignment2'])),
            DataCell(Text('${student.totalGrade}%')),
          ],
        );
      }).toList(),
    );
  }
}
```

## Testing Strategy

### Unit Tests
- [ ] Assignment CRUD operations
- [ ] File upload and storage logic
- [ ] Grade calculation algorithms
- [ ] Due date and late submission logic
- [ ] Rubric scoring calculations

### Widget Tests
- [ ] Assignment creation form validation
- [ ] File upload interface interactions
- [ ] Grading interface components
- [ ] Student submission workflow
- [ ] Gradebook data display

### Integration Tests
- [ ] End-to-end assignment creation and submission
- [ ] File upload and virus scanning
- [ ] Grade calculation and gradebook integration
- [ ] Cross-platform file handling
- [ ] Backup and recovery procedures

### Performance Tests
- [ ] Large file upload performance
- [ ] Gradebook loading with many assignments
- [ ] Assignment analytics calculation
- [ ] Mobile device file handling
- [ ] Concurrent submission handling

## Security Considerations

### File Security
- Virus scanning for all uploaded files
- File type validation and restrictions
- Storage quotas per student and course
- Secure file access with signed URLs
- Regular backup of submission data

### Academic Integrity
- Plagiarism detection integration
- Submission timestamp verification
- Version control for assignment modifications
- Audit trail for all grading activities
- Late submission penalty calculations

### Data Protection
- Student privacy in gradebook display
- Secure deletion of submission data
- FERPA compliance for grade data
- Encrypted storage of sensitive information
- Access control for assignment materials

## Plagiarism Detection Integration

### Service Integration
```dart
class PlagiarismDetectionService {
  Future<PlagiarismReport> scanSubmission(AssignmentSubmission submission) async {
    // Integration with plagiarism detection service
    final report = await _externalPlagiarismAPI.scan(
      text: submission.submissionText,
      files: submission.files,
      assignmentId: submission.assignmentId,
    );
    
    return PlagiarismReport.fromResponse(report);
  }
  
  Future<void> updateScanResults(String submissionId, PlagiarismReport report) async {
    await _supabase.from('plagiarism_reports').insert({
      'submission_id': submissionId,
      'similarity_percentage': report.similarityPercentage,
      'flagged_sections': report.flaggedSections,
      'sources_found': report.sourcesFound,
      'scan_date': DateTime.now().toIso8601String(),
    });
  }
}
```

## Grade Calculation Engine

### Weighted Categories
```dart
class GradeCalculator {
  double calculateCourseGrade(
    List<Assignment> assignments,
    List<AssignmentSubmission> submissions,
    GradeWeights weights,
  ) {
    final categoryGrades = <String, double>{};
    
    for (final category in weights.categories) {
      final categoryAssignments = assignments
          .where((a) => a.category == category.name)
          .toList();
      
      final categorySubmissions = submissions
          .where((s) => categoryAssignments
              .any((a) => a.id == s.assignmentId))
          .toList();
      
      final categoryAverage = _calculateCategoryAverage(
        categoryAssignments,
        categorySubmissions,
      );
      
      categoryGrades[category.name] = categoryAverage * category.weight;
    }
    
    return categoryGrades.values.reduce((a, b) => a + b);
  }
}
```

## Monitoring & Analytics

### Assignment Analytics
- Submission patterns and timing
- Grade distribution analysis
- Student engagement metrics
- File upload success rates
- Assignment completion rates

### Performance Metrics
- File upload speed and reliability
- Grading workflow efficiency
- Mobile vs desktop usage
- Assignment creation patterns
- System resource utilization

## Documentation Requirements

### Developer Documentation
- Assignment system API documentation
- File upload service integration guide
- Grade calculation engine specifications
- Database schema and relationships

### User Documentation
- Assignment creation guide for teachers
- Student submission instructions
- Gradebook management tutorial
- Mobile app assignment features

## Dependencies

### External Dependencies
- Virus scanning service (ClamAV or commercial)
- Plagiarism detection service integration
- File conversion services (PDF, Office docs)
- Push notification service

### Internal Dependencies
- Authentication system (Task 001)
- Database foundation (Task 002)
- Course management system (Task 003)
- File storage and management

### Flutter Package Dependencies
- file_picker: ^8.0.0
- flutter_pdfview: ^1.3.0
- image_picker: ^1.0.0
- flutter_dropzone_web: ^3.1.0
- mime: ^1.0.0
- path_provider: ^2.1.0

## Risk Assessment

### Technical Risks
- **High**: Large file upload reliability
- **Medium**: Cross-platform file handling consistency
- **Low**: Database performance with large datasets

### Mitigation Strategies
- Chunked file uploads with retry logic
- Comprehensive device and browser testing
- Database indexing and query optimization
- Regular performance monitoring and tuning

## Estimated Timeline

### Development: 7 days
- **Days 1-2**: Assignment creation and management system
- **Days 3-4**: Student submission interface and file handling
- **Days 5-6**: Grading system and rubric implementation
- **Day 7**: Analytics and reporting features

### Testing: 1.5 days
- End-to-end workflow testing
- File upload reliability testing
- Cross-platform compatibility
- Security validation

### Total Effort: 7 points (1.75 weeks)